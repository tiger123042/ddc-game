<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>‡πÄ‡∏Å‡∏°‡∏à‡∏µ‡∏ö‡∏™‡∏≤‡∏ß - ‡∏à‡∏±‡∏î‡∏´‡∏°‡∏π‡πà‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ DDC</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Kanit&display=swap');
  /* ... [styles remain unchanged] ... */
</style>
</head>
<body>
<h1>üìö ‡∏à‡∏µ‡∏ö‡∏°‡∏≤‡∏¢‡∏î‡πå & ‡∏à‡∏±‡∏î‡∏´‡∏°‡∏π‡πà‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ DDC</h1>

<div id="game-container">
  <img id="character-img" 
    src="https://cdn.pixabay.com/photo/2021/05/15/11/00/girl-6255532_1280.jpg" 
    alt="‡∏°‡∏≤‡∏¢‡∏î‡πå ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô‡∏´‡∏ç‡∏¥‡∏á‡πÉ‡∏™‡πà‡πÅ‡∏ß‡πà‡∏ô" draggable="false" />
  <div id="dialog-box"></div>
  <div id="choices"></div>
  <div id="score-display">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0</div>
</div>

<div id="start-screen">
  <h2>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</h2>
  <input type="text" id="player-name-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." />
  <button id="start-btn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
</div>

<!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î JavaScript ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheet -->
<script>
function submitScoreToSheet(name, score) {
  const url = "https://script.google.com/macros/s/AKfycbyE6A6wP3Xh5J4GPaoVYVkDmMvo2UHENIHBIWBFUYqOBv77aWTcx1fDfFbsyGQIHU-7/exec";

  const data = {
    name: name,
    score: score
  };

  fetch(url, {
    method: "POST",
    body: JSON.stringify(data),
    headers: {
      "Content-Type": "application/json"
    }
  })
  .then(response => response.json())
  .then(result => {
    console.log("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", result);
  })
  .catch(error => {
    console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:", error);
  });
}
</script>

<script>
  const dialogBox = document.getElementById('dialog-box');
  const choicesBox = document.getElementById('choices');
  const scoreDisplay = document.getElementById('score-display');
  const gameContainer = document.getElementById('game-container');
  const startScreen = document.getElementById('start-screen');
  const playerNameInput = document.getElementById('player-name-input');
  const startBtn = document.getElementById('start-btn');

  let playerName = '';
  let currentStage = 0;
  let dialogIndex = 0;
  let score = 0;

  const stages = [
    /* ... [unchanged stage content] ... */
  ];

  function setBackground(url) {
    gameContainer.style.backgroundImage = `url(${url})`;
  }

  function updateScore() {
    scoreDisplay.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}`;
  }

  function clearChoices() {
    choicesBox.innerHTML = "";
  }

  function disableChoices() {
    choicesBox.querySelectorAll("button").forEach(btn => btn.disabled = true);
  }

  function showFeedback(correct) {
    if(correct) {
      dialogBox.style.animation = 'correctFlash 0.6s';
    } else {
      dialogBox.style.animation = 'wrongFlash 0.6s';
    }
    dialogBox.addEventListener('animationend', () => {
      dialogBox.style.animation = '';
    }, { once: true });
  }

  function showDialog() {
    const stage = stages[currentStage];
    if (dialogIndex < stage.dialog.length) {
      const line = stage.dialog[dialogIndex];
      dialogBox.innerHTML = `<div class="speaker">${line.speaker}:</div><div>${line.text}</div>`;
      dialogIndex++;
      setTimeout(showDialog, 1600);
    } else {
      showQuestion();
    }
  }

  function showQuestion() {
    const stage = stages[currentStage];
    dialogBox.innerHTML = `<div class="speaker">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:</div><div>${stage.question}</div>`;
    clearChoices();

    const shuffledChoices = [...stage.choices].sort(() => Math.random() - 0.5);

    shuffledChoices.forEach((choice) => {
      const btn = document.createElement("button");
      btn.textContent = choice.text;
      btn.onclick = () => {
        disableChoices();
        if (choice.correct) {
          score += 10;
          updateScore();
          showFeedback(true);
          dialogBox.innerHTML = `<div class="speaker">‡∏°‡∏≤‡∏¢‡∏î‡πå:</div><div style="color:green;">${stage.correctResponse}</div>`;
          setTimeout(nextStage, 2000);
        } else {
          score -= 5;
          if(score < 0) score = 0;
          updateScore();
          showFeedback(false);
          dialogBox.innerHTML = `<div class="speaker">‡∏°‡∏≤‡∏¢‡∏î‡πå:</div><div style="color:red;">${stage.wrongResponse}</div>`;
          setTimeout(showQuestion, 2000);
        }
      };
      choicesBox.appendChild(btn);
    });
  }

  function nextStage() {
    currentStage++;
    dialogIndex = 0;
    if (currentStage >= stages.length) {
      dialogBox.innerHTML = `
        <div class="speaker">‡∏°‡∏≤‡∏¢‡∏î‡πå:</div>
        <div>üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢, <strong>${playerName}</strong>! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô <strong>${score}</strong> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞~ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô üíñ</div>
      `;
      clearChoices();
      setBackground("https://cdn.pixabay.com/photo/2017/08/06/00/43/books-2581596_960_720.jpg");
      submitScoreToSheet(playerName, score); // ‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏õ Google Sheet
    } else {
      setBackground(stages[currentStage].bg);
      showDialog();
    }
  }

  function startGame() {
    playerName = playerNameInput.value.trim();
    if (!playerName) {
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°');
      playerNameInput.focus();
      return;
    }
    startScreen.style.display = 'none';
    currentStage = 0;
    dialogIndex = 0;
    score = 0;
    updateScore();
    setBackground(stages[0].bg);
    showDialog();
  }

  startBtn.addEventListener('click', startGame);
  playerNameInput.addEventListener('keydown', e => {
    if(e.key === 'Enter') {
      startGame();
    }
  });

  document.getElementById('character-img').addEventListener('dragstart', e => e.preventDefault());
</script>
</body>
</html>
