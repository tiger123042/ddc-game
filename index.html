<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>เกมจัดหมู่หนังสือ DDC</title>
<style>
  /* ใส่ CSS ที่ต้องการ */
</style>
</head>
<body>

<div id="game">
  <input type="text" id="playerName" placeholder="ใส่ชื่อนักเรียน" />
  <button id="startBtn">เริ่มเล่น</button>

  <div id="questionSection" style="display:none;">
    <div id="questionText"></div>
    <div id="choices"></div>
  </div>

  <div id="resultSection" style="display:none;">
    <div>คะแนนของคุณ: <span id="score"></span></div>
    <button id="showLeaderboardBtn">ดูตารางคะแนน</button>
  </div>
</div>

<div id="leaderboard" style="display:none;">
  <h2>ตารางคะแนน</h2>
  <table border="1" id="scoreTable">
    <thead><tr><th>ชื่อ</th><th>คะแนน</th><th>เวลา</th></tr></thead>
    <tbody></tbody>
  </table>
  <button id="backBtn">กลับเล่นใหม่</button>
</div>

<script>
const questions = [
  { text: "หนังสือเลขหมู่ 300 คือหมวดอะไร?", choices: [{text:"ศิลปะ", score:0},{text:"สังคมศาสตร์", score:3},{text:"วิทยาศาสตร์", score:0}] },
  { text: "ถ้าฉันอยากเรียนเรื่องจักรวาล ต้องหาที่หมวดไหน?", choices: [{text:"520", score:3},{text:"920", score:0},{text:"320", score:0}] },
  { text: "หนังสือ 641 นี่เกี่ยวกับอะไร?", choices: [{text:"การทำอาหาร", score:3},{text:"กีฬา", score:0},{text:"แฟชั่น", score:0}] }
];

let currentQuestion = 0;
let score = 0;
let playerName = "";

const startBtn = document.getElementById('startBtn');
const playerNameInput = document.getElementById('playerName');
const questionSection = document.getElementById('questionSection');
const questionText = document.getElementById('questionText');
const choicesDiv = document.getElementById('choices');
const resultSection = document.getElementById('resultSection');
const scoreSpan = document.getElementById('score');
const showLeaderboardBtn = document.getElementById('showLeaderboardBtn');
const leaderboardDiv = document.getElementById('leaderboard');
const scoreTableBody = document.querySelector('#scoreTable tbody');
const backBtn = document.getElementById('backBtn');

startBtn.onclick = () => {
  playerName = playerNameInput.value.trim();
  if(!playerName) {
    alert("กรุณาใส่ชื่อก่อนเริ่มเกม");
    return;
  }
  startBtn.style.display = 'none';
  playerNameInput.style.display = 'none';
  questionSection.style.display = 'block';
  currentQuestion = 0;
  score = 0;
  showQuestion();
};

function showQuestion() {
  const q = questions[currentQuestion];
  questionText.textContent = q.text;
  choicesDiv.innerHTML = '';
  q.choices.forEach(choice => {
    const btn = document.createElement('button');
    btn.textContent = choice.text;
    btn.onclick = () => {
      score += choice.score;
      currentQuestion++;
      if(currentQuestion < questions.length) {
        showQuestion();
      } else {
        endGame();
      }
    };
    choicesDiv.appendChild(btn);
  });
}

function endGame() {
  questionSection.style.display = 'none';
  resultSection.style.display = 'block';
  scoreSpan.textContent = score;
  google.script.run.withSuccessHandler(() => {
    console.log("ส่งคะแนนสำเร็จ");
  }).withFailureHandler(() => {
    alert("ส่งคะแนนล้มเหลว");
  }).submitScore(playerName, score);
}

showLeaderboardBtn.onclick = () => {
  resultSection.style.display = 'none';
  leaderboardDiv.style.display = 'block';
  google.script.run.withSuccessHandler((data) => {
    scoreTableBody.innerHTML = '';
    data.forEach(row => {
      const tr = document.createElement('tr');
      const date = new Date(row.timestamp);
      tr.innerHTML = `<td>${row.name}</td><td>${row.score}</td><td>${date.toLocaleString('th-TH')}</td>`;
      scoreTableBody.appendChild(tr);
    });
  }).withFailureHandler(() => {
    alert("โหลดคะแนนล้มเหลว");
  }).getScores();
};

backBtn.onclick = () => {
  leaderboardDiv.style.display = 'none';
  resultSection.style.display = 'none';
  questionSection.style.display = 'none';
  playerNameInput.style.display = 'inline-block';
  startBtn.style.display = 'inline-block';
  playerNameInput.value = '';
};
</script>

</body>
</html>
